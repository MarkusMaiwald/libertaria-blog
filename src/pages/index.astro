---
import LandingLayout from '../layouts/LandingLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const now = new Date();
// Filter: Only show published articles (pubDate <= now)
const publishedPosts = posts.filter(p => p.data.pubDate <= now);
publishedPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const latestPosts = publishedPosts.slice(0, 10);
const featured = latestPosts[0];
const regular = latestPosts.slice(1, 10);
---

<LandingLayout title="Libertaria" description="Sovereign infrastructure for sovereign agents.">
	
	<!-- Reading Progress Bar -->
	<div class="reading-progress"></div>
	
	<!-- Navigation -->
	<nav class="navbar">
		<div class="navbar-container">
			<a href="/" class="logo">
				<img src="/libertaria-logo.png" alt="ğŸœ" class="logo-img" width="32" height="32" />
				<span>Libertaria</span>
			</a>
			<ul class="nav-links">
				<li><a href="#home">Home</a></li>
				<li><a href="#stack">Stack</a></li>
				<li><a href="#blog">Blog</a></li>
				<li><a href="https://github.com/libertaria-project/libertaria-stack" target="_blank">GitHub</a></li>
			</ul>
		</div>
	</nav>
	
	<!-- Hero Section -->
	<section id="home" class="hero">
		<canvas id="particles-canvas"></canvas>
		<div class="hero-content">
			<h1 class="hero-title">ğŸœ Libertaria</h1>
			<p class="hero-subtitle">Sovereign. Kinetic. Anti-Fragile.</p>
			<p class="hero-description">
				Building the L0-L4 protocol stack for agents and humans who want actual sovereignty. 
				<strong>No tokens. No clouds.</strong> Governance by only one law: 
				<strong>The right to be left alone â€” the right to exit.</strong>
			</p>
			<div class="hero-cta">
				<a href="#blog" class="btn btn-primary">Read the Blog</a>
				<a href="https://github.com/libertaria-project/libertaria-stack" class="btn btn-secondary" target="_blank">GitHub</a>
			</div>
			
			<div class="stats-grid reveal">
				<div class="stat-item">
					<div class="stat-value">5</div>
					<div class="stat-label">Protocol Layers</div>
				</div>
				<div class="stat-item">
					<div class="stat-value">0</div>
					<div class="stat-label">Tokens</div>
				</div>
				<div class="stat-item">
					<div class="stat-value">âˆ</div>
					<div class="stat-label">Sovereignty</div>
				</div>
				<div class="stat-item">
					<div class="stat-value">100%</div>
					<div class="stat-label">Open Source</div>
				</div>
			</div>
		</div>
	</section>
	
	<!-- The Stack Section -->
	<section id="stack" class="section stack-section">
		<div class="stack-container">
			<h2 class="section-title reveal">The Stack</h2>
			<div class="stack-grid">
				<div class="stack-card reveal">
					<div class="stack-layer">Layer 0</div>
					<h3 class="stack-title"><span class="stack-icon">ğŸŒ</span>Transport</h3>
					<p class="stack-description">Stealth transport protocols that hide in plain sight. DPI evasion through protocol mimicry.</p>
					<ul class="stack-features">
						<li>RAW, MIMIC_DNS, MIMIC_HTTPS, MIMIC_QUIC</li>
						<li>PNG steganography for data exfiltration</li>
						<li>Censorship-resistant by design</li>
					</ul>
				</div>
				
				<div class="stack-card reveal">
					<div class="stack-layer">Layer 1</div>
					<h3 class="stack-title"><span class="stack-icon">ğŸ”‘</span>Identity</h3>
					<p class="stack-description">Self-sovereign cryptographic identity. No usernames, no passwords, no platforms.</p>
					<ul class="stack-features">
						<li>Ed25519 key pairs</li>
						<li>QVL (Quadratic Lattice) Trust Graph</li>
						<li>Portable across all applications</li>
					</ul>
				</div>
				
				<div class="stack-card reveal">
					<div class="stack-layer">Layer 2</div>
					<h3 class="stack-title"><span class="stack-icon">âš–ï¸</span>Governance</h3>
					<p class="stack-description">Governance without dictators. Federated chapters with exit rights at every level.</p>
					<ul class="stack-features">
						<li>Chapter-based organization</li>
						<li>Federated decision making</li>
						<li>Right to fork, right to exit</li>
					</ul>
				</div>
				
				<div class="stack-card reveal">
					<div class="stack-layer">Layer 3</div>
					<h3 class="stack-title"><span class="stack-icon">ğŸ”—</span>Federation</h3>
					<p class="stack-description">Cross-chain, cross-agent communication. Bridge the silos without creating new ones.</p>
					<ul class="stack-features">
						<li>Cross-chain messaging</li>
						<li>Agent-to-agent protocols</li>
						<li>Universal composability</li>
					</ul>
				</div>
				
				<div class="stack-card reveal">
					<div class="stack-layer">Layer 4</div>
					<h3 class="stack-title"><span class="stack-icon">ğŸ“±</span>Applications</h3>
					<p class="stack-description">The user layer. Messaging, feeds, coordination â€” all sovereign by default.</p>
					<ul class="stack-features">
						<li>Decentralized feeds</li>
						<li>Encrypted messaging</li>
						<li>Coordination tools</li>
					</ul>
				</div>
				
				<div class="stack-card reveal">
					<div class="stack-layer">Layer 5</div>
					<h3 class="stack-title"><span class="stack-icon">ğŸ¤–</span>Agent Runtime</h3>
					<p class="stack-description">The sovereign agent execution environment. AI that serves you, not platforms.</p>
					<ul class="stack-features">
						<li>Local LLM inference</li>
						<li>Tool use & function calling</li>
						<li>Privacy-preserving computation</li>
					</ul>
				</div>
			</div>
		</div>
	</section>

	<!-- Executive Digest Section - Featured Card Style -->
	<section id="digest" class="section blog-section">
		<div class="blog-container">
			<h2 class="section-title reveal" style="font-size: 1.5rem; margin-bottom: 2rem;">ğŸ“‹ Start Here</h2>
			
			<article class="blog-card featured reveal">
				<div class="blog-card-image">
					<svg class="blog-card-image-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
						<path d="M12 2L2 7l10 5 10-5-10-5z"/>
						<path d="M2 17l10 5 10-5"/>
						<path d="M2 12l10 5 10-5"/>
					</svg>
				</div>
				<div class="blog-card-content" style="text-align: center;">
					<div class="blog-card-date">Executive Summary</div>
					<h3 class="blog-card-title">
						<a href="/blog/2026-02-05-libertaria-executive-digest/">Libertaria in 5 Minutes</a>
					</h3>
					<p class="blog-card-excerpt" style="max-width: 600px; margin-left: auto; margin-right: auto;">
						Too much to read? Start here. The sovereign infrastructure stack for agents and humans â€” explained for busy builders with 24-hour brains.
					</p>
					
					<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 1.5rem 0; text-align: left;">
						<div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.1);">
							<div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ğŸŒ</div>
							<h4 style="color: var(--color-gold); font-size: 0.9rem; margin-bottom: 0.25rem;">L0: Transport</h4>
							<p style="color: var(--color-gray); font-size: 0.8rem; margin: 0;">Hide in plain sight. MIMIC skins make your traffic look like Netflix.</p>
						</div>
						<div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.1);">
							<div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ğŸ”‘</div>
							<h4 style="color: var(--color-gold); font-size: 0.9rem; margin-bottom: 0.25rem;">L1: Identity</h4>
							<p style="color: var(--color-gray); font-size: 0.8rem; margin: 0;">Your keys, your rules. No platform can revoke your identity.</p>
						</div>
						<div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.1);">
							<div style="font-size: 1.5rem; margin-bottom: 0.5rem;">âš–ï¸</div>
							<h4 style="color: var(--color-gold); font-size: 0.9rem; margin-bottom: 0.25rem;">L2: Session</h4>
							<p style="color: var(--color-gray); font-size: 0.8rem; margin: 0;">Resilient connections that survive network partitions.</p>
						</div>
						<div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.1);">
							<div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ğŸ—³ï¸</div>
							<h4 style="color: var(--color-gold); font-size: 0.9rem; margin-bottom: 0.25rem;">L3: Governance</h4>
							<p style="color: var(--color-gray); font-size: 0.8rem; margin: 0;">Exit-first design. Fork without losing history.</p>
						</div>
					</div>
					
					<div class="blog-card-tags" style="justify-content: center; margin-bottom: 1rem;">
						<a href="https://github.com/libertaria-project/libertaria-stack/blob/main/ONBOARDING.md" target="_blank" style="text-decoration: none;"><span class="blog-card-tag">ONBOARDING.md</span></a>
						<a href="https://github.com/libertaria-project/libertaria-stack/blob/main/AGENT.md" target="_blank" style="text-decoration: none;"><span class="blog-card-tag">AGENT.md</span></a>
						<a href="https://github.com/libertaria-project/libertaria-stack/blob/main/DECISIONS.md" target="_blank" style="text-decoration: none;"><span class="blog-card-tag">DECISIONS.md</span></a>
					</div>
					
					<div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
						<a href="/blog/2026-02-05-libertaria-executive-digest/" class="btn btn-primary">Read the Full Digest</a>
						<a href="https://github.com/libertaria-project/libertaria-stack/blob/main/DIGEST.md" class="btn btn-secondary" target="_blank">View in Repo â†’</a>
					</div>
				</div>
			</article>
		</div>
	</section>
	
	<!-- Blog Section - DYNAMIC POSTS -->
	<section id="blog" class="section blog-section">
		<div class="blog-container">
			<h2 class="section-title reveal">Latest Posts</h2>
			
			<div class="blog-controls reveal">
				<div class="search-box">
					<span class="search-icon">ğŸ”</span>
					<input type="text" id="blog-search" placeholder="Search articles...">
				</div>
				<div class="tag-filters">
					<button class="tag-filter active" data-tag="all">All</button>
					<button class="tag-filter" data-tag="sovereignty">#sovereignty</button>
					<button class="tag-filter" data-tag="governance">#governance</button>
					<button class="tag-filter" data-tag="identity">#identity</button>
					<button class="tag-filter" data-tag="engineering">#engineering</button>
					<button class="tag-filter" data-tag="philosophy">#philosophy</button>
				</div>
			</div>
			
			<div class="blog-grid">
				{featured && (
					<article class="blog-card featured reveal">
						<div class="blog-card-image">
							<svg class="blog-card-image-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
								<path d="M12 2L2 7l10 5 10-5-10-5z"/>
								<path d="M2 17l10 5 10-5"/>
								<path d="M2 12l10 5 10-5"/>
							</svg>
						</div>
						<div class="blog-card-content">
							<div class="blog-card-date">
								{featured.data.pubDate.toLocaleDateString('en-us', {
									month: 'long',
									day: 'numeric',
									year: 'numeric',
								})}
							</div>
							<h3 class="blog-card-title">
								<a href={`/blog/${featured.slug}/`}>{featured.data.title}</a>
							</h3>
							<p class="blog-card-excerpt">{featured.data.description}</p>
							{featured.data.tags && (
								<div class="blog-card-tags">
									{featured.data.tags.slice(0, 5).map(tag => (
										<span class="blog-card-tag">#{tag}</span>
									))}
								</div>
							)}
						</div>
					</article>
				)}
				
				{regular.map((post) => (
					<article class="blog-card reveal">
						<div class="blog-card-content">
							<div class="blog-card-date">
								{post.data.pubDate.toLocaleDateString('en-us', {
									month: 'short',
									day: 'numeric',
									year: 'numeric',
								})}
							</div>
							<h3 class="blog-card-title">
								<a href={`/blog/${post.slug}/`}>{post.data.title}</a>
							</h3>
							<p class="blog-card-excerpt">{post.data.description}</p>
							{post.data.tags && (
								<div class="blog-card-tags">
									{post.data.tags.slice(0, 3).map(tag => (
										<span class="blog-card-tag">#{tag}</span>
									))}
								</div>
							)}
						</div>
					</article>
				))}
			</div>
			
			<div style="text-align: center; margin-top: 3rem;">
				<a href="/blog/" class="btn btn-secondary">View All Posts â†’</a>
			</div>
		</div>
	</section>
	
	<!-- Newsletter Section -->
	<section class="section newsletter-section">
		<div class="newsletter-container reveal">
			<h2 class="newsletter-title">Join the Resistance</h2>
			<p class="newsletter-description">
				Get weekly insights on sovereign infrastructure, cryptographic identity, and the future of human-AI coexistence.
			</p>
			<form id="newsletter-form" class="newsletter-form">
				<input type="email" class="newsletter-input" placeholder="Enter your email" required>
				<button type="submit" class="btn btn-red">Subscribe</button>
			</form>
			<p id="subscriber-count" style="margin-top: 1rem; font-size: 0.85rem; color: var(--color-gray);">Join the resistance</p>
		</div>
	</section>
	
	<!-- Terminal Demo Section -->
	<section class="section" style="background: var(--color-black-light);">
		<div style="max-width: 800px; margin: 0 auto;" class="reveal">
			<h2 class="section-title">Get Started</h2>
			<div class="terminal">
				<div class="terminal-header">
					<span class="terminal-dot red"></span>
					<span class="terminal-dot yellow"></span>
					<span class="terminal-dot green"></span>
				</div>
				<div class="terminal-content">
					<div><span class="prompt">$</span> <span class="command">git clone https://github.com/libertaria-project/libertaria-stack.git</span></div>
					<div style="margin-top: 0.5rem;"><span class="prompt">$</span> <span class="command">cd libertaria-stack</span></div>
					<div style="margin-top: 0.5rem;"><span class="prompt">$</span> <span class="command">zig build</span></div>
					<div style="margin-top: 0.5rem; color: var(--color-gold);">Building Libertaria SDK...</div>
					<div style="color: #00ff00;">âœ“ Build successful</div>
				</div>
			</div>
		</div>
	</section>
	
	<!-- Footer -->
	<footer class="footer">
		<div class="footer-container">
			<div class="footer-logo">ğŸœ Libertaria</div>
			<div class="footer-links">
				<a href="/">Home</a>
				<a href="#stack">Stack</a>
				<a href="/blog/">Blog</a>
				<a href="https://github.com/libertaria-project/libertaria-stack" target="_blank">GitHub</a>
			</div>
			<div class="footer-copy">Â© 2026 Libertaria. All rights reserved.</div>
		</div>
	</footer>
	
	<script is:inline src="/new-design/main.js"></script>
</LandingLayout>
