---
title: "Project Pnyx // The Libertaria Reference Node"
description: "**Status:** CANONICAL SPECIFICATION"
pubDate: 2026-01-30
author: "Markus Maiwald"
tags: [philosophy, sovereignty, libertaria]
featured: false
---

# Project Pnyx // The Libertaria Reference Node

> **"The means are the ends in the making."** — Zoe Baker

**Status:** CANONICAL SPECIFICATION
**Version:** 2.0
**Last Updated:** January 2026


## Overview

**Project Pnyx** is the reference implementation of a **Libertaria Free Society Node**. It is a sovereign, self-hosted nexus that connects a human being to the **Lattice**—a decentralized, censorship-resistant network of networks.

It rejects the "Monolithic Blockchain" model. Instead, it implements the **Orthogonal Stack**, strictly separating Communication (L0), Identity (L1), and Settlement (L2) into independent, modular organs.

**Pnyx** = The ancient Athenian hill where sovereignty was exercised.


## I. The Three Personas

Pnyx does not treat you as a single "Wallet Address." That is a privacy suicide pact.
Pnyx implements **Contextual Sovereignty** via Hierarchical Deterministic DIDs (HD-DIDs). The interface forces you to choose your mask before you act.

| Persona | Index | Context | Crypto Logic |
|:--------|:------|:--------|:-------------|
| **CITIZEN** | `0` | **The Face.** High-reputation, stable, public. Used for voting, UBI, land registry, and tax compliance. | Anchored DID. High `fractal_score`. Signatures are public and accountable. |
| **PIRATE** | `1` | **The Mask.** Ephemeral, rotatable, private. Used for dark markets, leaks, and dissent. | Hashed DID. Zero history. Signatures are Ring/Group or blind. |
| **GHOST** | `2+` | **The Void.** Single-use burners. Used for one-time signals or panicked exits. | Generated -> Signed -> Burned instantly. |

*By toggling between these personas in the UI, the user practices the mental hygiene of sovereignty.*


## II. The Orthogonal Architecture

Pnyx components strictly match the **Orthogonal Stack Hierarchy**.

| Layer | Lattice Canon | Pnyx Component | Tech Stack |
|:------|:--------------|:---------------|:-----------|
| **L0** | **Echo Lattice** | **Pnyx-Echo** | **Nim (libp2p/QUIC)** - The Wire. WebRTC/QUIC connections, packet transport. |
| **L1** | **Nexus Core** | **Pnyx-Core (Morpheus)** | **Nim (WASM)** - The Brain. Multi-Persona wallet, DID signing, routing decisions. |
| **L2** | **Flux Lattice** | **Pnyx-Flux (Adapter)** | **Rust** - The Muscle. Chain daemon connecting to Kaspa, Bitcoin, local ledgers. |
| **L3+** | **Keystone** | **Pnyx-HUD** | **Svelte + Vite** - The Face. User interface for charters, voting, governance. |
| **Probe** | - | **Red Team Sim** | **Python + Nimpy** - The Watchtower. Sybil attack simulation, Web of Trust visualization. |


## III. The Chimera Stack (Rust-Nim Symbiosis)

We accept the **Chimera**. Rust is the **Bone and Muscle** (structural integrity, raw power). Nim is the **Nervous System** (logic, adaptability, mutation).

### Layer Mapping

| Layer | Biological Role | Technology | Implementation |
|:------|:----------------|:-----------|:---------------|
| **L0** | The Arteries | **Rust** (Quasar Flux) | UDP/QUIC++, Post-Quantum Crypto (Kyber), CBOR. Compiles to `.a` static library. |
| **L1** | The Spine | **Rust** (Routing) | DID routing, adapter logic, async I/O (tokio). Exposes C-ABI hooks for Nim. |
| **L2** | The Brain | **Nim** (Hephaestus) | Consensus Engine, Casper FFG voting, DA logic. Calls Rust for network/crypto. |
| **Morpheus** | The Soul | **Nim** (Wallet) | Persona management, UI logic. Imports Rust crypto (Kyber/Dilithium). |

### Interop Method: Static Libraries

- **Rust** compiles to `libquasar.a` (Static Library)
- **Nim** compiles final executable, statically linking `libquasar.a`
- Zero FFI overhead, single binary output


## IV. Directory Structure

```text
pnyx-monorepo/
├── .gitignore
├── README.md              # This document
│
├── quasar_rs/             # [RUST] L0 & L1 (Network, Crypto, Routing)
│   ├── Cargo.toml         # configured as staticlib
│   └── src/lib.rs         # C-ABI exports
│
├── core/                  # [NIM] The Identity & Routing Brain
│   ├── src/
│   │   ├── morpheus.nim   # Persona/VC/Routing logic
│   │   ├── crypto.nim     # BIP32/Ed25519 wrapper
│   │   └── utils.nim
│   ├── nim.cfg            # Multi-target switchboard
│   └── pnyx_core.nimble
│
├── node/                  # [RUST] Flux Adapter (Chain Connection)
│   ├── Cargo.toml
│   ├── build.rs           # Links libmorpheus.a
│   └── src/
│       ├── main.rs        # Daemon entry
│       └── bridge.rs      # FFI to Nim Core
│
├── interface/             # [SVELTE] User Interface
│   ├── package.json
│   ├── vite.config.ts
│   └── src/
│       ├── App.svelte
│       └── lib/
│           └── morpheus.js   # Generated by Nim
│
├── sims/                  # [PYTHON] Red Team Simulations
│   ├── requirements.txt
│   ├── morpheus.so        # Generated by Nim
│   └── sybil_attack.py
│
└── scripts/
    └── forge_all.sh       # Compile Core for all targets
```


## V. The Nim Switchboard

**File: `core/nim.cfg`**

```nim
# --- GLOBAL SETTINGS ---
--mm:orc
--threads:on

# --- TARGET: JAVASCRIPT (Interface) ---
# Usage: nim js -d:pnyx_web src/morpheus.nim
@if pnyx_web:
  --backend:js
  --outdir:"../interface/src/lib"
  --out:"morpheus.js"
@end

# --- TARGET: STATIC LIBRARY (Rust Node) ---
# Usage: nim c -d:pnyx_node --app:staticlib src/morpheus.nim
@if pnyx_node:
  --app:staticlib
  --noMain
  --cpu:amd64
  --outdir:"../node/lib"
  --out:"libmorpheus.a"
  --header:"morpheus.h"
@end

# --- TARGET: SHARED LIBRARY (Python Sims) ---
# Usage: nim c -d:pnyx_sim --app:lib src/morpheus.nim
@if pnyx_sim:
  --app:lib
  --d:release
  --outdir:"../sims"
  --out:"morpheus.so"
@end
```


## VI. Core Logic: Morpheus Wallet

**File: `core/src/morpheus.nim`**

```nim
import std/[json, strutils, options]
import nimcrypto, bip32

type
  PersonaType* = enum
    Citizen = 0   # "The Face" (High Rep, Stable)
    Pirate = 1    # "The Mask" (Low Rep, Ephemeral)
    Ghost = 2     # "The Void" (One-time use)

  Persona* = object
    index*: uint32
    kind*: PersonaType
    did*: string      # did:mandala:type:hash
    pubKey*: string

  MorpheusWallet* = object
    masterSeed: seq[byte]
    personas: seq[Persona]

proc derivePersona*(wallet: MorpheusWallet, kind: PersonaType, index: uint32): Persona =
  # HD Path: m / 44' / 999' (Libertaria) / Kind' / Index'
  let path = "m/44'/999'/" & $ord(kind) & "'/" & $index & "'"
  let child = wallet.masterSeed.derivePath(path)

  let rawDid = sha256.digest(child.pubKey).toHex[0..16]
  let didString = "did:mandala:" & ($kind).toLowerAscii & ":" & rawDid

  result = Persona(
    kind: kind,
    did: didString,
    pubKey: child.pubKey.toHex
  )

proc signMessage*(p: Persona, message: string): string =
  case p.kind
  of Citizen: return signEd25519(p.privKey, message)
  of Pirate: return signSchnorr(p.privKey, message)
  of Ghost: return signEd25519(p.privKey, message)

# --- EXPORT INTERFACES ---
when defined(pnyx_web):
  import jsffi
  proc js_derive_persona(seed: cstring, kind: cint): JsObject {.exportc.} =
    let p = derivePersona(MorpheusWallet(masterSeed: seed), PersonaType(kind), 0)
    result = newJsObject()
    result.did = cstring(p.did)

when defined(pnyx_node):
  proc c_generate_did(seed: cstring, kind: cint): cstring {.exportc, dynlib.} =
    let p = derivePersona(MorpheusWallet(masterSeed: seed), PersonaType(kind), 0)
    return cstring(p.did)

when defined(pnyx_sim):
  import nimpy
  proc py_generate_persona(seed: string, kind: int): Persona {.exportpy.} =
    return derivePersona(MorpheusWallet(masterSeed: seed), PersonaType(kind), 0)
```


## VII. Rust Flux Adapter

**File: `node/src/main.rs`**

```rust
mod bridge;

#[tokio::main]
async fn main() {
    println!("PNYX FLUX ADAPTER: INITIALIZING...");

    // Ignite the Nim Brain
    bridge::init_nim_runtime();
    println!(">> Brain Online.");

    // Test FFI
    let did = bridge::generate_did("master_seed", 1);
    println!(">> Identity Derived: {}", did);

    // Start daemon
    println!(">> Listening for Lattice Packets...");
    // loop { ... }
}
```

**File: `node/src/bridge.rs`**

```rust
use std::ffi::{CStr, CString};
use std::os::raw::{c_char, c_int};

extern "C" {
    pub fn NimMain();
    pub fn c_generate_did(seed: *const c_char, kind: c_int) -> *const c_char;
}

pub fn init_nim_runtime() {
    unsafe { NimMain(); }
}

pub fn generate_did(seed: &str, kind: i32) -> String {
    let c_seed = CString::new(seed).unwrap();
    unsafe {
        let raw_ptr = c_generate_did(c_seed.as_ptr(), kind as c_int);
        CStr::from_ptr(raw_ptr).to_string_lossy().into_owned()
    }
}
```


## VIII. Forge Script

**File: `scripts/forge_all.sh`**

```bash
#!/bin/bash
set -e

echo "IGNITING HEPHAESTUS FORGE..."

# Cleanup
rm -f interface/src/lib/morpheus.js
rm -f node/lib/libmorpheus.a
rm -f sims/morpheus.so

# Forge Interface (Nim -> JS)
echo "Forging Interface (JS)..."
cd core && nim js -d:pnyx_web src/morpheus.nim && cd ..

# Forge Node (Nim -> Static Lib)
echo "Forging Node Adapter (Static Lib)..."
mkdir -p node/lib
cd core && nim c -d:pnyx_node src/morpheus.nim && cd ..

# Forge Simulator (Nim -> Shared Lib)
echo "Forging Simulation Probe (Python Lib)..."
cd core && nim c -d:pnyx_sim src/morpheus.nim && cd ..

echo "FORGE COMPLETE."
```


## IX. Data Flow Visualization

```
┌─────────────────────────────────────────────────────────────────┐
│  USER clicks "Pay 5 KAS" in Svelte Interface                    │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  L1 NEXUS (Nim-WASM)                                            │
│  - Selects "Citizen" Persona (DID)                              │
│  - Signs intent: "I, DID:Citizen, authorize 5 KAS"              │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  L0 ECHO (QUIC/WebRTC)                                          │
│  - Blasts signed packet to home node or relay                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  L2 FLUX (Rust Node)                                            │
│  - Verifies DID signature against L1 logic                      │
│  - ADAPTS to raw Kaspa transaction                              │
│  - Broadcasts to Hephaestus/Kaspa network                       │
└─────────────────────────────────────────────────────────────────┘
```


## X. Covenant

**We do not build platforms. We build exits.**

This code is released under the **Unlicense**. It belongs to the public domain.
Fork it. Mutate it. Break it.
But do not centralize it.


*Project Pnyx is a Bastion of the Libertaria V2 Reboot.*
